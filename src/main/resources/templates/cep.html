<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Busca de Endereço via CEP</title>
</head>

<body>

    <h2>Buscar Endereço</h2>

    <form id="formBuscarCep" method="GET" onsubmit="return false;">
        <label>CEP:</label>
        <input type="text" id="cep" name="cep" placeholder="Digite o CEP" maxlength="9" required>
        <button type="button" id="btnBuscarCep">Buscar</button>
    </form>

    <hr>

    <form method="POST" action="/salvar-endereco/">
        <label>Nome:</label>
        <input type="text" name="nome" placeholder="Nome do Usuário" required><br><br>

        <label>Logradouro:</label>
        <input type="text" id="logradouro" name="logradouro" placeholder="Logradouro" required><br><br>

        <label>Bairro:</label>
        <input type="text" id="bairro" name="bairro" placeholder="Bairro" required><br><br>

        <label>Cidade:</label>
        <input type="text" id="localidade" name="localidade" placeholder="Cidade" required><br><br>

        <label>Estado:</label>
        <input type="text" id="uf" name="uf" placeholder="Estado" required><br><br>

        <label>CEP:</label>
        <input type="text" id="cep_result" name="cep" readonly><br><br>

        <button type="submit">Salvar</button>
    </form>

    <script>
        const btnBuscarCep = document.getElementById("btnBuscarCep");

        btnBuscarCep.addEventListener("click", async function () {
            const cepInput = document.getElementById("cep");
            const cep = cepInput.value.replace(/\D/g, '');

            if (cep.length !== 8) {
                alert("CEP inválido. Digite 8 números.");
                return;
            }

            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();

                document.getElementById("logradouro").value = data.logradouro || "";
                document.getElementById("bairro").value = data.bairro || "";
                document.getElementById("localidade").value = data.localidade || "";
                document.getElementById("uf").value = data.uf || "";
                document.getElementById("cep_result").value = cep;

            } catch (error) {
                alert("Erro ao buscar o CEP.");
                console.error(error);
            }
        });
    </script>

</body>
</html>
